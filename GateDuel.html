<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>UnterGrund Gate Duel (Test)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #f5f5f5;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
      display: flex;
      justify-content: center;
      padding: 24px 12px;
    }

    .duel-wrap {
      width: 100%;
      max-width: 960px;
      background: rgba(15,23,42,0.96);
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow: 0 32px 80px rgba(0,0,0,0.85);
      padding: 18px 16px 18px;
    }

    .duel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .duel-title-block h1 {
      font-size: 22px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .duel-subtitle {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .header-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.75);
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      padding: 7px 13px;
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.16s;
    }

    .btn-primary {
      border-color: rgba(129,140,248,0.9);
      background: linear-gradient(90deg, #4f46e5, #7c3aed);
      color: #e5e7eb;
      font-weight: 600;
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 0 16px rgba(129,140,248,0.6);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .info-badge {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .players-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .player-card {
      border-radius: 16px;
      border: 1px solid rgba(55,65,81,0.9);
      background: radial-gradient(circle at top, #020617 0, #020617 60%, #000 100%);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .player-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 12px;
    }

    .player-name {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .player-label {
      font-size: 11px;
      color: #9ca3af;
    }

    .card-slot {
      border-radius: 14px;
      border: 1px dashed rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.96);
      padding: 10px;
      min-height: 140px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      text-align: center;
    }

    .card-slug {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      color: #9ca3af;
    }

    .card-name {
      font-size: 13px;
      font-weight: 600;
      color: #e5e7eb;
    }

    .card-img-placeholder {
      width: 90%;
      height: 80px;
      border-radius: 10px;
      background: radial-gradient(circle at top, #111827 0, #020617 70%);
      border: 1px solid rgba(55,65,81,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #6b7280;
    }

    .select-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.96);
      color: #e5e7eb;
      font-size: 12px;
    }

    .player-actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .status-row {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed rgba(55,65,81,0.9);
      font-size: 12px;
      color: #e5e7eb;
    }

    .status-main {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .status-detail {
      font-size: 11px;
      color: #9ca3af;
    }

    /* Info-Overlay */
    .info-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .info-box {
      max-width: 520px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      background: rgba(15,23,42,0.98);
      border-radius: 16px;
      border: 1px solid rgba(129,140,248,0.7);
      box-shadow: 0 0 40px rgba(129,140,248,0.7);
      padding: 18px 16px 16px;
      font-size: 13px;
    }

    .info-box h2 {
      margin: 0 0 8px;
      font-size: 18px;
    }

    .info-box h3 {
      margin: 12px 0 4px;
      font-size: 15px;
      color: #c7d2fe;
    }

    .info-box p {
      margin: 4px 0;
      color: #e5e7eb;
      line-height: 1.5;
    }

    .info-box ul {
      margin: 6px 0 8px 18px;
      padding: 0;
      color: #d1d5db;
      font-size: 12px;
    }

    .info-box li {
      margin-bottom: 4px;
    }

    .info-box code {
      background: rgba(129,140,248,0.15);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: ui-monospace, monospace;
      font-size: 11px;
      color: #c7d2fe;
    }

    .info-close {
      margin-top: 12px;
      text-align: right;
    }

    /* Duel-Modal */
    .duel-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.92);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
    }

    .duel-modal {
      max-width: 720px;
      width: 92%;
      background: rgba(15,23,42,0.98);
      border-radius: 20px;
      border: 1px solid rgba(129,140,248,0.8);
      box-shadow: 0 0 60px rgba(129,140,248,0.7);
      padding: 20px 18px 18px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .duel-modal h2 {
      margin: 0 0 12px;
      font-size: 20px;
      text-align: center;
    }

    .duel-cards-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
      margin-bottom: 14px;
    }

    .duel-card {
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.9);
      background: radial-gradient(circle at top, #020617 0, #020617 60%, #000 100%);
      padding: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-align: center;
      transition: all 0.4s;
    }

    .duel-card.revealed {
      border-color: rgba(129,140,248,0.9);
      box-shadow: 0 0 24px rgba(129,140,248,0.6);
    }

    .duel-card.winner {
      border-color: rgba(34,197,94,0.9);
      box-shadow: 0 0 32px rgba(34,197,94,0.8);
    }

    .duel-card-img {
      width: 100%;
      height: 120px;
      border-radius: 10px;
      background: radial-gradient(circle at top, #111827 0, #020617 70%);
      border: 1px solid rgba(55,65,81,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #6b7280;
    }

    .duel-card-name {
      font-size: 14px;
      font-weight: 600;
      color: #e5e7eb;
    }

    .duel-card-code {
      font-family: ui-monospace, monospace;
      font-size: 12px;
      color: #9ca3af;
    }

    .duel-card-value {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }

    .duel-step-section {
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(129,140,248,0.6);
      font-size: 13px;
    }

    .duel-step-title {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #a5b4fc;
      margin-bottom: 6px;
    }

    .duel-step-content {
      line-height: 1.5;
    }

    .duel-dice {
      font-size: 48px;
      text-align: center;
      margin: 10px 0;
    }

    .duel-result {
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      text-align: center;
      font-weight: 600;
    }

    .duel-result.win {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.6);
      color: #bbf7d0;
    }

    .duel-result.lose {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.6);
      color: #fecaca;
    }

    .duel-result.draw {
      background: rgba(148,163,184,0.15);
      border: 1px solid rgba(148,163,184,0.6);
      color: #e5e7eb;
    }

    .duel-modal-actions {
      margin-top: 14px;
      text-align: center;
    }

    @media (max-width: 720px) {
      .players-row {
        grid-template-columns: minmax(0, 1fr);
      }
      .duel-cards-row {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="duel-wrap">
    <div class="duel-header">
      <div class="duel-title-block">
        <h1>‚öîÔ∏è Gate Duel (Test)</h1>
        <div class="duel-subtitle">
          Zwei Test‚ÄëSpieler w√§hlen Gate‚ÄëKarten, setzen sie und spielen mit UG‚ÄëGATE‚ÄëCodes gegeneinander.
        </div>
        <div class="info-badge">
          Frontend‚ÄëDemo ohne Login oder Supabase ‚Äì nur zum Ausprobieren des Flows.
        </div>
      </div>
      <div class="header-actions">
        <button id="infoButton" class="btn">Regeln</button>
        <button id="resetButton" class="btn btn-primary">Neues Duel</button>
      </div>
    </div>

    <div class="players-row">
      <!-- Spieler A -->
      <div class="player-card" id="playerA">
        <div class="player-header">
          <div>
            <div class="player-name">Spieler A</div>
            <div class="player-label">setzt eine Gate-Karte</div>
          </div>
          <div id="stateA" class="player-label">Status: Auswahl</div>
        </div>

        <div class="card-slot" id="slotA">
          <div class="card-img-placeholder" id="imgA">Karte noch verdeckt</div>
          <div class="card-name" id="nameA">Keine Karte gew√§hlt</div>
          <div class="card-slug" id="slugA">UG‚ÄëGATE #----</div>
        </div>

        <div class="select-row">
          <select id="selectA">
            <option value="">Gate-Karte w√§hlen ‚Ä¶</option>
          </select>
          <div class="player-actions">
            <button id="goA" class="btn btn-primary" disabled>Go</button>
            <button id="cancelA" class="btn">Abbruch</button>
          </div>
        </div>
      </div>

      <!-- Spieler B -->
      <div class="player-card" id="playerB">
        <div class="player-header">
          <div>
            <div class="player-name">Spieler B</div>
            <div class="player-label">setzt eine Gate-Karte</div>
          </div>
          <div id="stateB" class="player-label">Status: Auswahl</div>
        </div>

        <div class="card-slot" id="slotB">
          <div class="card-img-placeholder" id="imgB">Karte noch verdeckt</div>
          <div class="card-name" id="nameB">Keine Karte gew√§hlt</div>
          <div class="card-slug" id="slugB">UG‚ÄëGATE #----</div>
        </div>

        <div class="select-row">
          <select id="selectB">
            <option value="">Gate-Karte w√§hlen ‚Ä¶</option>
          </select>
          <div class="player-actions">
            <button id="goB" class="btn btn-primary" disabled>Go</button>
            <button id="cancelB" class="btn">Abbruch</button>
          </div>
        </div>
      </div>
    </div>

    <div class="status-row">
      <div id="statusMain" class="status-main">W√§hle f√ºr beide Spieler eine Gate-Karte und best√§tige mit Go.</div>
      <div id="statusDetail" class="status-detail">Karten bleiben verdeckt, bis beide Go gedr√ºckt haben.</div>
    </div>
  </div>

  <!-- Regelwerk-Overlay -->
  <div id="infoOverlay" class="info-overlay">
    <div class="info-box">
      <h2>Gate Duel ‚Äì Regelwerk (Test)</h2>
      
      <h3>Ablauf</h3>
      <p>Jeder Spieler setzt eine Gate-Karte. Die Karten bleiben verdeckt, bis beide <strong>Go</strong> dr√ºcken.</p>
      
      <h3>UG‚ÄëGATE‚ÄëCode als Spielwert</h3>
      <p>Jede Gate-Karte hat einen Code aus den letzten 4 Zeichen ihres Slugs (z.B. <code>AB12</code>).</p>
      <p>Dieser Code wird in <strong>Basis-36</strong> in eine Dezimalzahl umgerechnet:</p>
      <ul>
        <li>Ziffern 0‚Äì9 = Wert 0‚Äì9</li>
        <li>Buchstaben A‚ÄìZ = Wert 10‚Äì35</li>
      </ul>
      <p><strong>Beispiel:</strong> <code>AB12</code></p>
      <p style="font-size:12px; color:#9ca3af; line-height:1.6;">
        Von rechts nach links:<br>
        2 √ó 36‚Å∞ = 2 √ó 1 = 2<br>
        1 √ó 36¬π = 1 √ó 36 = 36<br>
        B (=11) √ó 36¬≤ = 11 √ó 1296 = 14256<br>
        A (=10) √ó 36¬≥ = 10 √ó 46656 = 466560<br>
        <strong>Summe = 480854</strong>
      </p>
      <p>‚Üí <code>AB12</code> wird zu <strong>480854</strong>.</p>

      <h3>W√ºrfel-Regeln</h3>
      <p>Nach dem Aufdecken wird eine Regel per W√ºrfel (1‚Äì6) bestimmt:</p>
      <ul>
        <li><strong>1‚Äì2:</strong> Gr√∂√üerer Code-Wert gewinnt. Gleichstand = Unentschieden.</li>
        <li><strong>3‚Äì4:</strong> Kleinerer Code-Wert gewinnt. Gleichstand = Unentschieden.</li>
        <li><strong>5:</strong> Gerade gewinnt. Sind beide gerade oder beide ungerade ‚Üí Unentschieden.</li>
        <li><strong>6:</strong> H√∂here Stellensumme (Basis-36) gewinnt. Gleichstand = Unentschieden.</li>
      </ul>

      <h3>Kartentransfer (sp√§ter)</h3>
      <p>In dieser Testversion werden keine echten Karten verschoben. In der echten Version w√ºrde der Verlierer seine gesetzte Gate‚ÄëKarte verlieren und der Gewinner sie in sein Gate‚ÄëAlbum bekommen.</p>
      
      <div class="info-close">
        <button id="closeInfo" class="btn btn-primary">Verstanden</button>
      </div>
    </div>
  </div>

  <!-- Duel-Modal -->
  <div id="duelModalOverlay" class="duel-modal-overlay">
    <div class="duel-modal" id="duelModal">
      <h2 id="duelModalTitle">üé¥ Duell l√§uft ...</h2>

      <div class="duel-cards-row">
        <div class="duel-card" id="duelCardA">
          <div class="duel-card-img" id="duelImgA">???</div>
          <div class="duel-card-name" id="duelNameA">Spieler A</div>
          <div class="duel-card-code" id="duelCodeA">UG‚ÄëGATE #----</div>
          <div class="duel-card-value" id="duelValueA"></div>
        </div>

        <div class="duel-card" id="duelCardB">
          <div class="duel-card-img" id="duelImgB">???</div>
          <div class="duel-card-name" id="duelNameB">Spieler B</div>
          <div class="duel-card-code" id="duelCodeB">UG‚ÄëGATE #----</div>
          <div class="duel-card-value" id="duelValueB"></div>
        </div>
      </div>

      <div id="duelStepSection" class="duel-step-section" style="display:none;">
        <div class="duel-step-title" id="duelStepTitle"></div>
        <div class="duel-step-content" id="duelStepContent"></div>
      </div>

      <div id="duelResultBox" class="duel-result" style="display:none;"></div>

      <div class="duel-modal-actions">
        <button id="closeDuelModal" class="btn btn-primary">Schlie√üen</button>
      </div>
    </div>
  </div>

  <script>
    // Dummy-Gatekarten f√ºr den Test
    const dummyCards = [
      {
        id: 'gate-1',
        name: 'Eule am Feuer',
        slug: 'ug-gate-ab12',
        imageLabel: 'ü¶âüî•',
      },
      {
        id: 'gate-2',
        name: 'Neon Tunnel',
        slug: 'ug-gate-7xq9',
        imageLabel: 'üåÜ‚ú®',
      },
      {
        id: 'gate-3',
        name: 'Subway Phantom',
        slug: 'ug-gate-55zz',
        imageLabel: 'üëªüöá',
      },
    ];

    const selectA = document.getElementById('selectA');
    const selectB = document.getElementById('selectB');
    const goA = document.getElementById('goA');
    const goB = document.getElementById('goB');
    const cancelA = document.getElementById('cancelA');
    const cancelB = document.getElementById('cancelB');

    const nameA = document.getElementById('nameA');
    const nameB = document.getElementById('nameB');
    const slugAEl = document.getElementById('slugA');
    const slugBEl = document.getElementById('slugB');
    const imgA = document.getElementById('imgA');
    const imgB = document.getElementById('imgB');
    const stateA = document.getElementById('stateA');
    const stateB = document.getElementById('stateB');

    const statusMain = document.getElementById('statusMain');
    const statusDetail = document.getElementById('statusDetail');

    const infoOverlay = document.getElementById('infoOverlay');
    const infoButton = document.getElementById('infoButton');
    const closeInfo = document.getElementById('closeInfo');
    const resetButton = document.getElementById('resetButton');

    const duelModalOverlay = document.getElementById('duelModalOverlay');
    const duelModal = document.getElementById('duelModal');
    const closeDuelModal = document.getElementById('closeDuelModal');

    const duelModalTitle = document.getElementById('duelModalTitle');
    const duelCardA = document.getElementById('duelCardA');
    const duelCardB = document.getElementById('duelCardB');
    const duelImgA = document.getElementById('duelImgA');
    const duelImgB = document.getElementById('duelImgB');
    const duelNameA = document.getElementById('duelNameA');
    const duelNameB = document.getElementById('duelNameB');
    const duelCodeA = document.getElementById('duelCodeA');
    const duelCodeB = document.getElementById('duelCodeB');
    const duelValueA = document.getElementById('duelValueA');
    const duelValueB = document.getElementById('duelValueB');
    const duelStepSection = document.getElementById('duelStepSection');
    const duelStepTitle = document.getElementById('duelStepTitle');
    const duelStepContent = document.getElementById('duelStepContent');
    const duelResultBox = document.getElementById('duelResultBox');

    let selectionA = null;
    let selectionB = null;
    let confirmedA = false;
    let confirmedB = false;

    function base36FromSlugLast4(slug) {
      if (!slug) return 0;
      const part = slug.slice(-4);
      const value = parseInt(part, 36);
      return Number.isNaN(value) ? 0 : value;
    }

    function sumDigitsBase36(slug) {
      if (!slug) return 0;
      const part = slug.slice(-4).toUpperCase();
      let sum = 0;
      for (const ch of part) {
        const v = parseInt(ch, 36);
        if (!Number.isNaN(v)) sum += v;
      }
      return sum;
    }

    function formatCode(slug) {
      if (!slug) return '----';
      const part = slug.slice(-4).toUpperCase();
      return part;
    }

    function populateSelect(selectEl) {
      selectEl.innerHTML = '<option value="">Gate-Karte w√§hlen ‚Ä¶</option>';
      dummyCards.forEach(card => {
        const opt = document.createElement('option');
        opt.value = card.id;
        opt.textContent = `${card.name} (${formatCode(card.slug)})`;
        selectEl.appendChild(opt);
      });
    }

    function resetDuel() {
      selectionA = null;
      selectionB = null;
      confirmedA = false;
      confirmedB = false;

      populateSelect(selectA);
      populateSelect(selectB);

      nameA.textContent = 'Keine Karte gew√§hlt';
      nameB.textContent = 'Keine Karte gew√§hlt';
      slugAEl.textContent = 'UG‚ÄëGATE #----';
      slugBEl.textContent = 'UG‚ÄëGATE #----';
      imgA.textContent = 'Karte noch verdeckt';
      imgB.textContent = 'Karte noch verdeckt';

      goA.disabled = true;
      goB.disabled = true;

      stateA.textContent = 'Status: Auswahl';
      stateB.textContent = 'Status: Auswahl';

      statusMain.textContent = 'W√§hle f√ºr beide Spieler eine Gate-Karte und best√§tige mit Go.';
      statusDetail.textContent = 'Karten bleiben verdeckt, bis beide Go gedr√ºckt haben.';
    }

    function updateSelection(player, cardId) {
      const card = dummyCards.find(c => c.id === cardId) || null;
      if (player === 'A') {
        selectionA = card;
        confirmedA = false;
        stateA.textContent = 'Status: Auswahl';
        imgA.textContent = card ? 'Karte gew√§hlt (verdeckt)' : 'Karte noch verdeckt';
        nameA.textContent = card ? card.name : 'Keine Karte gew√§hlt';
        slugAEl.textContent = card ? 'UG‚ÄëGATE #' + formatCode(card.slug) : 'UG‚ÄëGATE #----';
        goA.disabled = !card;
      } else {
        selectionB = card;
        confirmedB = false;
        stateB.textContent = 'Status: Auswahl';
        imgB.textContent = card ? 'Karte gew√§hlt (verdeckt)' : 'Karte noch verdeckt';
        nameB.textContent = card ? card.name : 'Keine Karte gew√§hlt';
        slugBEl.textContent = card ? 'UG‚ÄëGATE #' + formatCode(card.slug) : 'UG‚ÄëGATE #----';
        goB.disabled = !card;
      }
    }

    function checkReveal() {
      if (!selectionA || !selectionB) return;
      if (!confirmedA || !confirmedB) return;

      // Modal √∂ffnen und Step-by-step durchlaufen
      startDuelModal();
    }

    async function startDuelModal() {
      duelModalOverlay.style.display = 'flex';
      duelModalTitle.textContent = 'üé¥ Duell l√§uft ...';

      // Reset Modal-Karten
      duelCardA.classList.remove('revealed', 'winner');
      duelCardB.classList.remove('revealed', 'winner');
      duelImgA.textContent = '???';
      duelImgB.textContent = '???';
      duelNameA.textContent = 'Spieler A';
      duelNameB.textContent = 'Spieler B';
      duelCodeA.textContent = 'UG‚ÄëGATE #----';
      duelCodeB.textContent = 'UG‚ÄëGATE #----';
      duelValueA.textContent = '';
      duelValueB.textContent = '';
      duelStepSection.style.display = 'none';
      duelResultBox.style.display = 'none';

      await sleep(800);

      // Schritt 1: Karten aufdecken
      duelModalTitle.textContent = 'üé¥ Karten werden aufgedeckt ...';
      duelCardA.classList.add('revealed');
      duelCardB.classList.add('revealed');
      duelImgA.textContent = selectionA.imageLabel;
      duelImgB.textContent = selectionB.imageLabel;
      duelNameA.textContent = selectionA.name;
      duelNameB.textContent = selectionB.name;
      const codeA = formatCode(selectionA.slug);
      const codeB = formatCode(selectionB.slug);
      duelCodeA.textContent = 'UG‚ÄëGATE #' + codeA;
      duelCodeB.textContent = 'UG‚ÄëGATE #' + codeB;

      await sleep(1200);

      // Schritt 2: Code-Umrechnung
      const valA = base36FromSlugLast4(selectionA.slug);
      const valB = base36FromSlugLast4(selectionB.slug);
      duelValueA.textContent = `Wert: ${valA}`;
      duelValueB.textContent = `Wert: ${valB}`;

      duelStepSection.style.display = 'block';
      duelStepTitle.textContent = 'Code-Umrechnung (Basis-36)';
      duelStepContent.innerHTML = `
        <strong>Spieler A:</strong> <code>${codeA}</code> ‚Üí <strong>${valA}</strong><br>
        <strong>Spieler B:</strong> <code>${codeB}</code> ‚Üí <strong>${valB}</strong><br>
        <span style="font-size:11px; color:#9ca3af;">(Basis-36: Ziffern 0-9 = 0-9, A-Z = 10-35, Stellenwerte 36‚Å∞, 36¬π, 36¬≤, 36¬≥)</span>
      `;

      await sleep(2000);

      // Schritt 3: W√ºrfel
      duelStepTitle.textContent = 'Regel wird ausgew√ºrfelt ...';
      duelStepContent.innerHTML = '<div class="duel-dice">üé≤</div>';
      await sleep(1000);

      const dice = Math.floor(Math.random() * 6) + 1;
      duelStepContent.innerHTML = `<div class="duel-dice">üé≤ ${dice}</div>`;
      await sleep(800);

      // Schritt 4: Regel anwenden
      const sumA = sumDigitsBase36(selectionA.slug);
      const sumB = sumDigitsBase36(selectionB.slug);

      let winner = null; // 'A', 'B' oder null
      let ruleText = '';
      let detailText = '';

      if (dice === 1 || dice === 2) {
        ruleText = 'Gr√∂√üerer Code-Wert gewinnt.';
        if (valA > valB) winner = 'A';
        else if (valB > valA) winner = 'B';
        detailText = `Code A: ${valA}, Code B: ${valB}.`;
      } else if (dice === 3 || dice === 4) {
        ruleText = 'Kleinerer Code-Wert gewinnt.';
        if (valA < valB) winner = 'A';
        else if (valB < valA) winner = 'B';
        detailText = `Code A: ${valA}, Code B: ${valB}.`;
      } else if (dice === 5) {
        ruleText = 'Gerade gewinnt. Sind beide gleich (gerade/ungerade), ist es unentschieden.';
        const evenA = valA % 2 === 0;
        const evenB = valB % 2 === 0;
        if (evenA && !evenB) winner = 'A';
        else if (evenB && !evenA) winner = 'B';
        detailText = `Code A: ${valA} (${evenA ? 'gerade' : 'ungerade'}), Code B: ${valB} (${evenB ? 'gerade' : 'ungerade'}).`;
      } else {
        ruleText = 'H√∂here Stellensumme (Basis-36) gewinnt.';
        if (sumA > sumB) winner = 'A';
        else if (sumB > sumA) winner = 'B';
        detailText = `Summe A: ${sumA}, Summe B: ${sumB}.`;
      }

      duelStepTitle.textContent = `Regel (W√ºrfel ${dice})`;
      duelStepContent.innerHTML = `
        <strong>${ruleText}</strong><br>
        <span style="font-size:11px; color:#9ca3af;">${detailText}</span>
      `;

      await sleep(1800);

    // Schritt 5: Ergebnis
      duelModalTitle.textContent = 'üé¥ Ergebnis';
      duelResultBox.style.display = 'block';

      if (winner === 'A') {
        duelCardA.classList.add('winner');
        duelResultBox.className = 'duel-result win';
        duelResultBox.textContent = 'üèÜ Spieler A gewinnt! Im echten Modus w√ºrde die Karte von Spieler B r√ºberwandern.';
      } else if (winner === 'B') {
        duelCardB.classList.add('winner');
        duelResultBox.className = 'duel-result lose';
        duelResultBox.textContent = 'üèÜ Spieler B gewinnt! Im echten Modus w√ºrde die Karte von Spieler A r√ºberwandern.';
      } else {
        duelResultBox.className = 'duel-result draw';
        duelResultBox.textContent = 'ü§ù Unentschieden ‚Äì bei dieser Regel sind beide Codes gleich stark.';
      }
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Event Wiring
    selectA.addEventListener('change', () => {
      updateSelection('A', selectA.value || null);
    });

    selectB.addEventListener('change', () => {
      updateSelection('B', selectB.value || null);
    });

    goA.addEventListener('click', () => {
      if (!selectionA) return;
      confirmedA = true;
      stateA.textContent = 'Status: Go gesetzt';
      statusMain.textContent = 'Beide m√ºssen Go gedr√ºckt haben, damit die Karten aufgedeckt werden.';
      statusDetail.textContent = '';
      checkReveal();
    });

    goB.addEventListener('click', () => {
      if (!selectionB) return;
      confirmedB = true;
      stateB.textContent = 'Status: Go gesetzt';
      statusMain.textContent = 'Beide m√ºssen Go gedr√ºckt haben, damit die Karten aufgedeckt werden.';
      statusDetail.textContent = '';
      checkReveal();
    });

    cancelA.addEventListener('click', () => {
      confirmedA = false;
      stateA.textContent = 'Status: abgebrochen';
      statusMain.textContent = 'Duel abgebrochen. Starte ein neues Duel, wenn ihr bereit seid.';
      statusDetail.textContent = '';
    });

    cancelB.addEventListener('click', () => {
      confirmedB = false;
      stateB.textContent = 'Status: abgebrochen';
      statusMain.textContent = 'Duel abgebrochen. Starte ein neues Duel, wenn ihr bereit seid.';
      statusDetail.textContent = '';
    });

    infoButton.addEventListener('click', () => {
      infoOverlay.style.display = 'flex';
    });

    closeInfo.addEventListener('click', () => {
      infoOverlay.style.display = 'none';
    });

    infoOverlay.addEventListener('click', (e) => {
      if (e.target === infoOverlay) {
        infoOverlay.style.display = 'none';
      }
    });

    closeDuelModal.addEventListener('click', () => {
      duelModalOverlay.style.display = 'none';
    });

    resetButton.addEventListener('click', () => {
      resetDuel();
    });

    // Init
    resetDuel();
  </script>
</body>
</html>
