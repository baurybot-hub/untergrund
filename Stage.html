<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>UnterGrund Stage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link
    href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap"
    rel="stylesheet"
  />

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #f5f5f5;
      background: #020617;
      overflow: hidden;
    }

    /* ── Video-Hintergrund ───────────────────────────────────── */

    .bg-video {
      position: fixed;
      inset: 0;
      overflow: hidden;
      z-index: -2;
      background: #000;
    }

    /* Desktop: komplette 16:9 Bühne sichtbar (Letterbox) */
    .bg-video video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center center;
      filter: brightness(0.6) saturate(1.2);
      background: #000;
    }

    /* Mobile: Video darf fullscreen wirken */
    @media (max-width: 600px) {
      .bg-video video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center top;
        background: #000;
      }
    }

    .overlay {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse at top center,
          rgba(28,255,136,0.18) 0%,
          rgba(0,0,0,0.3) 40%,
          rgba(0,0,0,0.85) 100%);
      z-index: -1;
      pointer-events: none;
    }

    /* ── Stage-Photo-Orb ────────────────────────────────────── */

    .stage-photo-orb {
      position: fixed;
      top: 13vh;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 200px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid rgba(28,255,136,0.9);
      box-shadow:
        0 0 28px rgba(28,255,136,0.7),
        0 0 80px rgba(0,0,0,0.95);
      background: radial-gradient(circle, #000 0, #020617 60%);
      z-index: 0;
    }
    .stage-photo-orb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .orb-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 11px;
      line-height: 1.4;
      color: #c4fce0;
      padding: 10px;
    }

    @media (max-width: 600px) {
      .stage-photo-orb {
        top: 16vh;
        width: 180px;
        height: 180px;
      }
    }

    /* ── Wrapper ────────────────────────────────────────────── */

    .stage-wrap {
      position: relative;
      min-height: 100vh;
      padding: 0 14px 24px;
      display: flex;
      justify-content: center;
      align-items: flex-end;
    }

    /* ── Backstage-Pass-Card ───────────────────────────────── */

    .stage-pass {
      width: 100%;
      max-width: 820px;
      background: radial-gradient(circle at top left,
                  rgba(15,23,42,0.96) 0,
                  rgba(2,6,23,0.98) 45%,
                  rgba(0,0,0,0.98) 100%);
      border-radius: 24px;
      border: 1px solid rgba(55,65,81,0.95);
      box-shadow:
        0 30px 80px rgba(0,0,0,0.95),
        0 0 30px rgba(34,197,94,0.45);
      padding: 16px 18px 14px;
      position: relative;
      color: #e5e7eb;
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    /* Lasche oben (Backstage-Pass-Anmutung) */
    .stage-pass::before {
      content: "";
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 24px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: radial-gradient(circle at top,
                  rgba(15,23,42,0.96) 0,
                  rgba(15,23,42,0.9) 55%,
                  rgba(15,23,42,0) 100%);
      box-shadow: 0 6px 16px rgba(0,0,0,0.9);
    }
    .stage-pass::after {
      content: "";
      position: absolute;
      top: -3px;
      left: 50%;
      transform: translateX(-50%);
      width: 22px;
      height: 6px;
      border-radius: 999px;
      background: rgba(15,23,42,1);
      border: 1px solid rgba(75,85,99,0.95);
    }

    /* Header */
    .stage-pass-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .stage-pass-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(34,197,94,0.8);
      box-shadow: 0 0 14px rgba(34,197,94,0.45);
    }
    .pass-label {
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #bbf7d0;
    }
    .pass-tier {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      padding: 2px 8px;
      border-radius: 999px;
      background: linear-gradient(90deg,#22c55e,#06b6d4);
      color: #022c22;
    }

    .pass-close {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.75);
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      padding: 6px 12px;
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
    }
    .pass-close:hover {
      border-color: #22c55e;
      box-shadow: 0 0 12px rgba(34,197,94,0.35);
    }

    /* Main: ID-Spalte + Meta-Spalte */
    .stage-pass-main {
      display: grid;
      grid-template-columns: minmax(0,1.4fr) minmax(0,1fr);
      gap: 18px;
      margin-bottom: 12px;
    }

    /* ID-Spalte */
    .pass-id-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .pass-chip-row {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(75,85,99,0.9);
      font-size: 11px;
    }
    .chip {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      background: linear-gradient(135deg,#22c55e,#0ea5e9);
      box-shadow: 0 0 12px rgba(34,197,94,0.6);
    }
    .chip-text {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
    }
    .chip-id {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: #e5e7eb;
    }

    .pass-name-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #9ca3af;
      margin-bottom: 2px;
    }
    .pass-name-value {
      font-family: "Russo One", system-ui, sans-serif;
      font-size: 24px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #f9fafb;
      text-shadow: 0 0 10px rgba(0,0,0,0.8);
    }

    .pass-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .pass-tag {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
    }
    .pass-tag-stage {
      border-color: rgba(34,197,94,0.9);
      color: #bbf7d0;
    }
    .pass-tag-status {
      color: #e5e7eb;
    }

    /* Meta-Spalte */
    .pass-meta-column {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .pass-meta-block {
      padding: 8px 9px;
      border-radius: 14px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(51,65,85,0.95);
    }
    .pass-meta-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #7dd3fc;
      margin-bottom: 2px;
    }
    .pass-meta-text {
      font-size: 13px;
      line-height: 1.5;
      color: #e5e7eb;
      white-space: pre-wrap;
    }

    /* Body: 2 Textbereiche */
    .stage-pass-body {
      display: grid;
      grid-template-columns: minmax(0,1fr) minmax(0,1fr);
      gap: 16px;
      padding-top: 10px;
      border-top: 1px solid rgba(31,41,55,0.9);
    }
    .pass-section-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9effc7;
      margin-bottom: 4px;
    }
    .pass-section-text {
      font-size: 13px;
      line-height: 1.6;
      color: #e5e7eb;
      white-space: pre-wrap;
    }

    /* Footer */
    .stage-pass-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px dashed rgba(55,65,81,0.9);
    }
    .pass-status-line {
      font-size: 12px;
      color: #fca5a5;
      min-height: 1.2em;
    }
    .pass-footer-code {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: #9ca3af;
    }
    .code-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #6ee7b7;
    }

    /* Links */
    .contact-link a {
      color: #22c55e;
      text-decoration: none;
      word-break: break-all;
    }
    .contact-link a:hover {
      text-decoration: underline;
    }

    /* Mobile */
    @media (max-width: 600px) {
      .stage-wrap {
        padding: 0 10px 16px;
      }

      .stage-pass {
        padding: 14px 12px 12px;
        border-radius: 20px;
      }

      .stage-pass-main {
        grid-template-columns: minmax(0,1fr);
        gap: 12px;
      }

      .stage-pass-body {
        grid-template-columns: minmax(0,1fr);
        gap: 12px;
      }

      .pass-name-value {
        font-size: 20px;
      }

      .pass-close {
        padding: 5px 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Hintergrund-Video -->
  <div class="bg-video">
    <video src="Stage.mp4" autoplay muted loop playsinline></video>
  </div>
  <div class="overlay"></div>

  <!-- Stage-Foto-Orb -->
  <div class="stage-photo-orb" id="stageOrb">
    <div class="orb-placeholder" id="orbPlaceholder">
      Exklusives Stage‑Foto<br />
      wird hier angezeigt,<br />
      sobald der Artist eines<br />
      hochgeladen hat.
    </div>
  </div>

  <!-- Backstage-Pass-Card -->
  <div class="stage-wrap">
    <div class="stage-pass">
      <div class="stage-pass-header">
        <div class="stage-pass-badge">
          <span class="pass-label">UNDERGROUND → STAGE</span>
          <span class="pass-tier">PUSHED</span>
        </div>
        <button id="backButton" class="pass-close">Zurück</button>
      </div>

      <div class="stage-pass-main">
        <div class="pass-id-column">
          <div class="pass-chip-row">
            <span class="chip"></span>
            <span class="chip-text">Stage‑ID</span>
            <span id="artistIdDisplay" class="chip-id">#0000</span>
          </div>

          <div class="pass-name">
            <div class="pass-name-label">Artist</div>
            <div id="artistName" class="pass-name-value">Artist Name</div>
          </div>

          <div class="pass-tag-row">
            <span class="pass-tag pass-tag-stage">Stage</span>
            <span class="pass-tag pass-tag-status" id="passStatusTag">pending</span>
          </div>
        </div>

        <div class="pass-meta-column">
          <div class="pass-meta-block">
            <div class="pass-meta-label">Collab‑Wunsch</div>
            <div id="collabNote" class="pass-meta-text"></div>
          </div>
          <div class="pass-meta-block">
            <div class="pass-meta-label">Kontakt</div>
            <div id="contact" class="pass-meta-text contact-link"></div>
          </div>
        </div>
      </div>

      <div class="stage-pass-body">
        <div class="pass-section">
          <div class="pass-section-label">Verbindung zu Musik</div>
          <div id="musicConnection" class="pass-section-text"></div>
        </div>
        <div class="pass-section">
          <div class="pass-section-label">Botschaft an die UnterGrund‑Community</div>
          <div id="ugMessage" class="pass-section-text"></div>
        </div>
      </div>

      <div class="stage-pass-footer">
        <div id="status" class="pass-status-line"></div>
        <div class="pass-footer-code">
          <span class="code-label">UG‑Route</span>
          <span class="code-value">EXPLORER › COMMUNITY › STAGE</span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>
  <script>
    const SUPABASE_URL = "https://tyflhzwrwzfakwedipig.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_OkJhaPak_fd0nNg1vxRLPQ_gOiaI6Tb";
    const STORAGE_BUCKET = "stage-photos";

    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const artistNameEl = document.getElementById("artistName");
    const musicConnectionEl = document.getElementById("musicConnection");
    const ugMessageEl = document.getElementById("ugMessage");
    const collabNoteEl = document.getElementById("collabNote");
    const contactEl = document.getElementById("contact");
    const statusEl = document.getElementById("status");
    const backButton = document.getElementById("backButton");
    const orb = document.getElementById("stageOrb");
    const orbPlaceholder = document.getElementById("orbPlaceholder");
    const artistIdDisplay = document.getElementById("artistIdDisplay");
    const passStatusTag = document.getElementById("passStatusTag");

    function setStatus(msg) {
      statusEl.textContent = msg || "";
    }

    function getArtistIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get("artist_id");
    }

    function goBackToExplorer(artistId) {
      if (artistId) {
        window.location.href = `index.html?artist=${encodeURIComponent(artistId)}`;
      } else {
        window.location.href = "index.html";
      }
    }

    async function loadStage() {
      const artistId = getArtistIdFromUrl();
      if (!artistId) {
        setStatus("Keine artist_id in der URL gefunden.");
        return;
      }

      backButton.addEventListener("click", () => goBackToExplorer(artistId));
      setStatus("Stage wird geladen …");

      const { data, error } = await client
        .from("artists")
        .select("id, name, stage_unlocked, stage_music_connection, stage_ug_message, stage_photo_path, stage_collab_note, stage_contact")
        .eq("id", artistId)
        .limit(1)
        .single();

      if (error || !data) {
        console.error(error);
        setStatus("Stage konnte nicht geladen werden.");
        return;
      }

      artistNameEl.textContent = data.name || "Artist";
      artistIdDisplay.textContent = data.id ? "#" + String(data.id).padStart(4,"0") : "#0000";

      if (!data.stage_unlocked) {
        setStatus("Dieser Artist wurde noch nicht offiziell auf die Stage eingeladen.");
        passStatusTag.textContent = "pending";
        passStatusTag.style.borderColor = "rgba(248,113,113,0.9)";
        passStatusTag.style.color = "#fecaca";
      } else {
        setStatus("");
        passStatusTag.textContent = "live";
        passStatusTag.style.borderColor = "rgba(34,197,94,0.9)";
        passStatusTag.style.color = "#bbf7d0";
      }

      musicConnectionEl.textContent = data.stage_music_connection || "Noch nichts eingetragen.";
      ugMessageEl.textContent = data.stage_ug_message || "Noch keine Botschaft an die Community.";
      collabNoteEl.textContent = data.stage_collab_note || "Noch kein Collab‑Wunsch hinterlegt.";

      if (data.stage_contact) {
        const link = document.createElement("a");
        link.href = data.stage_contact;
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.textContent = data.stage_contact;
        contactEl.innerHTML = "";
        contactEl.appendChild(link);
      } else {
        contactEl.textContent = "Noch kein Kontaktlink angegeben.";
      }

      // Stage-Foto im Orb
      if (data.stage_photo_path) {
        const { data: publicUrlData } = client
          .storage
          .from(STORAGE_BUCKET)
          .getPublicUrl(data.stage_photo_path);

        if (publicUrlData && publicUrlData.publicUrl && orb) {
          const img = document.createElement("img");
          img.src = publicUrlData.publicUrl;
          orb.innerHTML = "";
          orb.appendChild(img);
        }
      }
    }

    loadStage();
  </script>
</body>
</html>
